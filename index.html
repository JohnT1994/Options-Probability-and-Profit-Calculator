<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Options Analysis Station</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.1"></script>
  <style>
    body { 
      font-family: 'Segoe UI', sans-serif; background-color: #000; color: #fff;
      background-image: url('https://i.imgur.com/nVWumk7.png'); background-size: cover; background-attachment: fixed;
      margin: 0; padding: 20px; display: flex; justify-content: center;
    }
    .main-station { background: rgba(0, 0, 0, 0.95); width: 100%; max-width: 900px; padding: 30px; border-radius: 15px; border: 1px solid #333; }
    h1 { text-align: center; font-size: 2.2rem; margin-bottom: 30px; }
    .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .full-width { grid-column: span 2; }
    .input-group { display: flex; flex-direction: column; }
    label { font-size: 0.8rem; color: #aaa; margin-bottom: 5px; font-weight: bold; }
    input, select { padding: 12px; border-radius: 8px; border: 1px solid #444; background: #fff; color: #000; font-size: 1rem; }
    .row-btn { display: flex; gap: 10px; align-items: flex-end; }
    .btn-green { background: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .btn-gray { background: #444; color: white; border: none; padding: 12px 15px; border-radius: 8px; cursor: pointer; }
    .btn-blue { background: #007bff; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.1rem; margin-top: 10px; }
    
    /* Summary Cards */
    #results { display: none; margin-top: 30px; }
    .summary-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 20px; }
    .card { background: #111; padding: 20px; border-radius: 12px; border-left: 4px solid #007bff; }
    .card label { font-size: 0.75rem; color: #888; }
    .card div { font-size: 1.1rem; font-weight: bold; margin-top: 5px; }

    /* Chart Container */
    .chart-box { background: #000; border-radius: 12px; padding: 20px; border: 1px solid #222; height: 400px; position: relative; }

    /* Greeks Section */
    .greeks-row { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 20px; }
    .greek-box { background: #1a1a1a; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid #333; }
    .greek-label { font-size: 0.7rem; color: #4db8ff; font-weight: bold; margin-bottom: 5px; display: flex; align-items: center; justify-content: center; gap: 5px; }
    .q-btn { width: 14px; height: 14px; border: 1px solid #4db8ff; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
    
    footer { text-align: center; margin-top: 40px; font-size: 0.7rem; color: #555; line-height: 1.6; }

    @media (max-width: 600px) {
      .input-grid, .summary-row, .greeks-row { grid-template-columns: 1fr 1fr; }
      .full-width { grid-column: span 2; }
    }
  </style>
</head>
<body>

<div class="main-station">
  <h1>Options Analysis Station</h1>

  <div class="input-grid">
    <div class="input-group full-width">
      <label>Ticker Symbol</label>
      <div class="row-btn">
        <input type="text" id="symbol" style="flex:1" placeholder="e.g. NVDA">
        <button class="btn-green" onclick="fetchPrice()">Fetch Price</button>
      </div>
    </div>

    <div class="input-group"><label>Stock Price ($)</label><input type="number" id="stockPrice" step="0.01"></div>
    <div class="input-group"><label>Contracts (Qty)</label><input type="number" id="qty" value="1"></div>

    <div class="input-group">
      <label>Expiration Date</label>
      <div class="row-btn"><input type="text" id="expiry" readonly><button class="btn-gray" onclick="pickExpiry()">Pick</button></div>
    </div>
    <div class="input-group">
      <label>Strike Price ($)</label>
      <div class="row-btn"><input type="number" id="strike"><button class="btn-gray" onclick="pickStrike()">Pick</button></div>
    </div>

    <div class="input-group"><label>Option Type</label><select id="type"><option value="call">Call</option><option value="put">Put</option></select></div>
    <div class="input-group"><label>Risk-Free Rate (%)</label><input type="number" id="rf" value="4.25" step="0.01"></div>
    <div class="input-group"><label>Dividend Yield (%)</label><input type="number" id="div" value="0.00"></div>
    <div class="input-group"><label>Premium (Market Price)</label><input type="number" id="prem" step="0.01"></div>

    <div class="input-group full-width">
      <label>Implied Volatility (%)</label>
      <input type="text" id="iv" placeholder="Calculated on Pick">
    </div>

    <button class="btn-blue full-width" onclick="runAnalysis()">Run Full Analysis</button>
  </div>

  <div id="results">
    <div class="summary-row">
      <div class="card"><label>Prob. of Profit</label><div id="resPop">--</div></div>
      <div class="card"><label>Total Cost</label><div id="resCost">--</div></div>
      <div class="card"><label>Max Profit</label><div id="resProfit">--</div></div>
      <div class="card"><label>Max Loss</label><div id="resLoss">--</div></div>
      <div class="card"><label>Breakeven</label><div id="resBe">--</div></div>
    </div>

    <div class="chart-box"><canvas id="payoffChart"></canvas></div>

    <div class="greeks-row">
      <div class="greek-box"><div class="greek-label">DELTA <span class="q-btn" onclick="alert('Delta: Price sensitivity to $1 stock move')">?</span></div><span id="d">--</span></div>
      <div class="greek-box"><div class="greek-label">GAMMA <span class="q-btn" onclick="alert('Gamma: Rate of change in Delta')">?</span></div><span id="g">--</span></div>
      <div class="greek-box"><div class="greek-label">THETA <span class="q-btn" onclick="alert('Theta: Daily time decay')">?</span></div><span id="t">--</span></div>
      <div class="greek-box"><div class="greek-label">VEGA <span class="q-btn" onclick="alert('Vega: Sensitivity to volatility')">?</span></div><span id="v">--</span></div>
      <div class="greek-box"><div class="greek-label">RHO <span class="q-btn" onclick="alert('Rho: Sensitivity to interest rates')">?</span></div><span id="r">--</span></div>
    </div>
  </div>

  <footer>
    &copy; 2026 Options Analysis Station. All rights reserved.<br>
    MIT License: Permission is hereby granted, free of charge, to any person obtaining a copy of this software...
  </footer>
</div>

<script>
let chart = null;

function runAnalysis() {
    const S = parseFloat(document.getElementById('stockPrice').value);
    const K = parseFloat(document.getElementById('strike').value);
    const prem = parseFloat(document.getElementById('prem').value);
    const type = document.getElementById('type').value;
    const qty = parseInt(document.getElementById('qty').value);
    const be = type === 'call' ? K + prem : K - prem;

    document.getElementById('resBe').innerText = be.toFixed(2);
    document.getElementById('resCost').innerText = "$" + (prem * 100 * qty);
    document.getElementById('results').style.display = 'block';

    updateChart(S, K, type, prem, qty, be);
    // Calculations for Greeks would happen here
    document.getElementById('d').innerText = "0.542"; // Sample data
}

function updateChart(S, K, type, prem, qty, be) {
    const ctx = document.getElementById('payoffChart').getContext('2d');
    const labels = [], dataAtExpiry = [], dataToday = [];
    for(let i = S*0.8; i <= S*1.2; i += (S*0.4)/50) {
        labels.push(i.toFixed(2));
        let profit = type === 'call' ? Math.max(0, i-K)-prem : Math.max(0, K-i)-prem;
        dataAtExpiry.push(profit * 100 * qty);
        dataToday.push((profit * 0.7) * 100 * qty); // Simulated T+0
    }

    if(chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels,
            datasets: [
                { label: 'At Expiry', data: dataAtExpiry, borderColor: '#007bff', fill: true, backgroundColor: 'rgba(0,123,255,0.1)', pointRadius: 0 },
                { label: 'Today (T+0)', data: dataToday, borderColor: '#fff', borderDash: [5,5], pointRadius: 0 }
            ]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: {
                annotation: {
                    annotations: {
                        lineBe: {
                            type: 'line', xMin: labels.indexOf(labels.reduce((a,b)=>Math.abs(b-be)<Math.abs(a-be)?b:a)), 
                            xMax: labels.indexOf(labels.reduce((a,b)=>Math.abs(b-be)<Math.abs(a-be)?b:a)),
                            borderColor: '#ff4d4d', borderWidth: 2,
                            label: { 
                                display: true, content: 'Breakeven', backgroundColor: '#ff4d4d',
                                yAdjust: (type === 'call' ? -30 : 30) // OFFSET 1
                            }
                        },
                        linePrice: {
                            type: 'line', xMin: labels.indexOf(labels.reduce((a,b)=>Math.abs(b-S)<Math.abs(a-S)?b:a)),
                            xMax: labels.indexOf(labels.reduce((a,b)=>Math.abs(b-S)<Math.abs(a-S)?b:a)),
                            borderColor: '#ffcc00', borderWidth: 2,
                            label: { 
                                display: true, content: 'Current Price', backgroundColor: '#ffcc00', color: '#000',
                                yAdjust: (type === 'call' ? 30 : -30) // OFFSET 2
                            }
                        }
                    }
                }
            }
        }
    });
}
// Placeholder functions for Fetch/Pick logic
function fetchPrice() { document.getElementById('stockPrice').value = "182.81"; }
function pickExpiry() { document.getElementById('expiry').value = "20/03/2026"; }
function pickStrike() { 
    document.getElementById('strike').value = "250"; 
    document.getElementById('iv').value = "25.98"; // IV Injection
}
</script>
</body>
</html>
